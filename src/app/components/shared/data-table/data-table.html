<!-- PAGINACIÓN -->
<app-pagination-controls
  [totalData]="sortedData"
  [pageSizeOptions]="[5, 10, 20, 50]"
  (pagedDataChange)="handlePagedData($event)"
  (onPageChange)="handlePageChange($event)"
  (onTotalPagesChange)="handleTotalPages($event)"
>
  <div class="container mt-3 mb-1">
    <!-- CONTENEDOR CON SCROLL -->
    <div class="table-responsive" style="max-height: 350px; overflow-x: auto; overflow-y: auto">
      <!-- TABLA -->
      <table class="table table-bordered table-hover table-striped align-middle">
        <!-- ENCABEZADO -->
        <thead class="table-primary">
          <tr>
            <!-- COLUMNAS -->
            @for (col of colArray; track $index) {
            <th
              (click)="sort(col.field)"
              style="cursor: pointer; white-space: nowrap"
              class="px-3 py-2"
            >
              {{ col.header }}

              <!-- INDICADOR DE ORDEN -->
              @if (sortField === col.field) {
              <span class="ms-1">
                {{ sortDirection === 'asc' ? '▲' : '▼' }}
              </span>
              }
            </th>
            }

            <!-- COLUMNA DE ACCIONES -->
            @if (showView || showEdit || showDelete) {
            <th class="px-3 py-2">Acciones</th>
            }
          </tr>
        </thead>

        <!-- CUERPO -->
        <tbody>
          <!-- FILAS -->
          @for (row of pagedData; track $index) {
          <tr>
            <!-- CELDAS -->
            @for (col of colArray; track col.field) {
            <td class="px-3 py-2">
              @if (col.type === 'longtext') {
              <span
                class="truncate-text"
                style="cursor: pointer"
                (click)="openModal(row[col.field])"
              >
                {{ row[col.field] }}
              </span>

              } @else if (col.lookup) {
              {{ col.lookup(row[col.field]) }}

              } @else if (col.type === 'boolean') {
              {{ row[col.field] ? 'Sí' : 'No' }}

              } @else {
              {{ row[col.field] }}
              }
            </td>
            }

            <!-- BOTONES DE ACCIONES -->
            @if (showView || showEdit || showDelete) {
            <td class="px-3 py-2">
              @if (showView) {
              <button class="btn btn-secondary btn-sm me-2" (click)="view(row)">
                <i class="bi bi-eye-fill"></i>
              </button>
              } @if (showEdit) {
              <button class="btn btn-primary btn-sm me-2" (click)="edit(row)">
                <i class="bi bi-pencil-fill"></i>
              </button>
              } @if (showDelete) {
              <button class="btn btn-danger btn-sm me-2" (click)="delete(row)">
                <i class="bi bi-trash-fill"></i>
              </button>
              }
            </td>
            }
          </tr>
          }
        </tbody>

        <!-- TEXTO CUANDO NO HAY DATOS -->
        @if (pagedData.length === 0) {
        <tr>
          <td
            [attr.colspan]="colArray.length + (showView || showEdit || showDelete ? 1 : 0)"
            class="text-center py-4 text-muted"
          >
            <i class="bi bi-inbox fs-3 d-block mb-2"></i>
            No hay datos para mostrar
          </td>
        </tr>
        }
      </table>
    </div>
  </div>

  <!-- MODAL PARA TEXTO LARGO -->
  @if (showModal) {
  <div class="custom-modal">
    <div class="custom-modal-content">
      <div class="custom-modal-header">
        <h5>{{ modalTitle }}</h5>
        <button class="close-btn" (click)="closeModal()">×</button>
      </div>

      <div class="custom-modal-body">
        {{ selectedText }}
      </div>

      <div class="custom-modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Cerrar</button>
      </div>
    </div>
  </div>
  }
</app-pagination-controls>
